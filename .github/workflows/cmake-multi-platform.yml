# AI Assistance: GitHub Copilot was used to generate this CI/CD workflow configuration
# CI configuration for bilsim - inspired by threepp's proven CI setup
# Requirements: CMake 3.21+, C++20

name: Bilsim CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  linux-gcc:
    runs-on: ubuntu-24.04  # Updated to Ubuntu 24.04 (has CMake 3.28+, GCC 13+)
    env:
      CC: gcc
      CXX: g++
    steps:
      - uses: actions/checkout@v4

      - name: Install prerequisites
        run: |
          sudo apt-get update && sudo apt-get install -y \
          libxinerama-dev \
          libxcursor-dev \
          libxrandr-dev \
          libxi-dev \
          xorg-dev \
          libglu1-mesa-dev \
          libgl1-mesa-dev \
          libwayland-dev \
          libxkbcommon-dev \
          wayland-protocols \
          pkg-config \
          ninja-build

      - name: Verify versions
        run: |
          cmake --version
          gcc --version
          g++ --version

      - name: Configure and build
        run: |
          cmake . -B build -DCMAKE_BUILD_TYPE=Release
          cmake --build build

      - name: Test
        run: |
          cd build
          ctest --output-on-failure

  linux-clang:
    runs-on: ubuntu-24.04  # Updated to Ubuntu 24.04 (has CMake 3.28+, Clang 18+)
    env:
      CC: clang
      CXX: clang++
    steps:
      - uses: actions/checkout@v4

      - name: Install prerequisites
        run: |
          sudo apt-get update && sudo apt-get install -y \
          libxinerama-dev \
          libxcursor-dev \
          libxrandr-dev \
          libxi-dev \
          xorg-dev \
          libglu1-mesa-dev \
          libgl1-mesa-dev \
          libwayland-dev \
          libxkbcommon-dev \
          wayland-protocols \
          pkg-config \
          ninja-build

      - name: Verify versions
        run: |
          cmake --version
          clang --version
          clang++ --version

      - name: Configure and build
        run: |
          cmake . -B build -DCMAKE_BUILD_TYPE=Release
          cmake --build build

      - name: Test
        run: |
          cd build
          ctest --output-on-failure

  windows:
    runs-on: windows-2022  # Latest Windows runner (VS 2022, CMake 3.27+)
    steps:
      - uses: actions/checkout@v4

      - name: Verify versions
        run: |
          cmake --version

      - name: Configure and build
        run: |
          cmake . -A x64 -B build -DCMAKE_BUILD_TYPE=Release
          cmake --build build --config Release

      - name: Test
        run: |
          cd build
          ctest -C Release --output-on-failure

  macos:
    runs-on: macos-14  # Updated to macOS 14 (M1, Xcode 15+, CMake 3.28+)
    steps:
      - uses: actions/checkout@v4

      - name: Verify versions
        run: |
          cmake --version
          clang --version

      - name: Configure and build
        run: |
          cmake . -B build -DCMAKE_BUILD_TYPE=Release
          cmake --build build

      - name: Test
        run: |
          cd build
          ctest --output-on-failure
